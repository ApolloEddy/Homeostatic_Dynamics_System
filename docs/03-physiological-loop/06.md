**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./05.md)** | **下一节：—**

# 03.6 实现细节
### 6.1 时间步进

#### 6.1.1 Tick 策略

HDS 的 Tick 策略：

- 按回合 tick + 空闲时补 tick
- 避免后台常驻耗电/耗资源

#### 6.1.2 Tick 实现

Tick 实现逻辑：

1. 将时间间隔转换为小时数
2. 如果时间间隔小于阈值，则不处理
3. 计算社交饱腹感自然衰减（孤独积累）
4. 计算认知能量自然恢复（空闲时）
5. 更新最后 tick 时间戳
6. 保存状态

**关键逻辑**：
- 社交饱腹感：$H_{social}(t+\Delta t) = H_{social}(t) - d_s \Delta t + w_{quality} \cdot quality$
- 认知能量：$H_{energy}(t+\Delta t) = H_{energy}(t) + r_e \Delta t - c_e \cdot complexity$
- 时间阈值：$\Delta t_{\min}$（最小步进阈值，用于避免过高频率更新）

**参数解释**：
- $\Delta t_{\min}$：最小步进阈值（不展示真实数值）

### 6.2 状态持久化

#### 6.2.1 存储策略

HDS 使用 SharedPreferences 实现状态持久化：

- 本地存储
- 可选加密
- 自动保存

#### 6.2.2 存储结构

存储结构示例（使用占位符 token；不包含任何真实数值）：

```json
{
  "social": "<H_social>",
  "energy": "<H_energy>",
  "da": "<N_DA>",
  "ne": "<N_NE>",
  "ht": "<N_5HT>",
  "lastTick": "<ISO8601_TIMESTAMP>"
}
```

**参数解释**：
- `<H_social>`：\(H_{\mathrm{social}}(t)\)，社交饱腹感（有界）
- `<H_energy>`：\(H_{\mathrm{energy}}(t)\)，认知能量（有界）
- `<N_DA>/<N_NE>/<N_5HT>`：三通道神经调制变量（有界）
- `<ISO8601_TIMESTAMP>`：时间戳占位符（示意格式）

### 6.3 初始化策略

#### 6.3.1 首次初始化

首次初始化时，HDS 使用默认值：

- 加载配置文件
- 创建内驱力引擎
- 创建神经递质系统
- 创建刺激归一化器
- 应用自上次 tick 以来的衰减

#### 6.3.2 后续启动

后续启动时，HDS 从持久化存储加载状态：

- 加载存储的状态
- 计算自上次 tick 以来的时间间隔
- 应用时间衰减

---

**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./05.md)** | **下一节：—**
