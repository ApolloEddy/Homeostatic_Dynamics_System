**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./01.md)** | **[下一节](./03.md)**

# 02.2 三层架构设计
HDS 采用三层架构设计，每层负责不同的功能：

### 2.1 L1 数字生理循环（Digital Physiological Loop）

**定位**：April 的"潜意识与生命体征"

**职责**：
- 管理内驱力变量（Homeostasis）
- 管理神经递质系统（Neuromodulators）
- 处理外界刺激输入
- 执行时间步进

**核心组件**：
- `HomeostaticEngine`：内驱力引擎
- `NeuromodulatorSystem`：神经递质系统
- `StimulusNormalizer`：刺激归一化器

**驱动方式**：
- 独立于对话回合的 time-step 驱动
- 可按固定步长 \(\Delta t_{\mathrm{tick}}\)（单位：秒）运行，或按回合驱动 tick
- 支持空闲时补 tick

### 2.2 L2 神经接口与编译器（Interface & Style Compiler）

**定位**：连接数值系统与商业 LLM API 的桥梁

**职责**：
- 将生理状态翻译为行为向量
- 编译动态系统指令
- 生成采样参数建议
- 计算检索偏置权重

**核心组件**：
- `BehaviorVector`：行为向量
- `ControlBundle`：控制输出包
- `StyleCompiler`：风格编译器
- `SamplingBounds`：采样边界

**核心原则**：
- 采样参数只做粗调
- 语义级人格与"失控表现"主要靠"风格编译器"控制

### 2.3 L3 长时序人格固化（Synaptic Consolidation）

**定位**：减少灾难性遗忘与人格漂移

**职责**：
- 记录交互日志
- 分箱记忆存储
- 离线巩固处理
- 慢变量更新

**核心组件**：
- `MemoryService`：记忆服务
- `MemoryIngester`：记忆摄入器
- `MemoryClassifier`：记忆分类器
- `MemoryRetrievalEnhancer`：检索增强器
- `ConsolidationEngine`：巩固引擎
- `ConsolidationScheduler`：巩固调度器

**触发条件**：
- 闲置/夜间/对话间隔达到阈值
- 手动触发

---

**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./01.md)** | **[下一节](./03.md)**
