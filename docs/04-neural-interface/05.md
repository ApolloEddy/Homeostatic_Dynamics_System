**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./04.md)** | **[下一节](./06.md)**

# 04.5 采样超参映射
### 5.1 设计原理

采样超参映射将神经递质状态映射为 LLM 采样参数。为了避免将"人格"变成"胡言乱语/重复"，采样参数只做粗调，且限幅。

### 5.2 温度（Temperature）映射

#### 5.2.1 映射公式

温度映射：

$$
T_t = \mathrm{clamp}\bigl(T_{\min}, T_{\max},\ \alpha_T - \beta_T\cdot N_{\mathrm{NE}}(t)\bigr)
$$

其中：
- \(T_t\)：温度（temperature）
- \(T_{\min},T_{\max}\)：温度边界（不展示真实数值）
- \(N_{\mathrm{NE}}(t)\)：NE 通道状态
- \(\alpha_T,\beta_T\)：映射系数（伪变量；有界）

**参数解释**：
- \(T_{\min},T_{\max}\)：限幅边界（对齐“采样边界”配置）
- \(\alpha_T\)：基线项（符号化；不展示真实数值）
- \(\beta_T\)：NE 影响系数（符号化；不展示真实数值）

**映射逻辑**：
- \(N_{\mathrm{NE}}\) 高 \(\rightarrow\) \(T_t \downarrow\)（更保守、更确定）
- \(N_{\mathrm{NE}}\) 低 \(\rightarrow\) \(T_t \uparrow\)（更发散、更随机）

#### 5.2.2 限幅保护

温度限幅：

$$
T \in [T_{min}, T_{max}]
$$

### 5.3 Top-P 映射

#### 5.3.1 映射公式

Top-P 映射：

$$
P_t = \mathrm{clamp}\bigl(P_{\min}, P_{\max},\ \alpha_P - \beta_{P,\mathrm{NE}}\cdot N_{\mathrm{NE}}(t) + \beta_{P,\mathrm{5HT}}\cdot N_{\mathrm{5HT}}(t)\bigr)
$$

其中：
- \(P_t\)：top-p
- \(P_{\min},P_{\max}\)：top-p 边界（不展示真实数值）
- \(N_{\mathrm{NE}}(t),N_{\mathrm{5HT}}(t)\)：NE/5HT 通道状态
- \(\alpha_P,\beta_{P,\mathrm{NE}},\beta_{P,\mathrm{5HT}}\)：映射系数（伪变量；有界）

**参数解释**：
- \(P_{\min},P_{\max}\)：限幅边界（对齐“采样边界”配置）
- \(\alpha_P\)：基线项（符号化；不展示真实数值）
- \(\beta_{P,\mathrm{NE}},\beta_{P,\mathrm{5HT}}\)：通道影响系数（符号化；不展示真实数值）

**映射逻辑**：
- \(N_{\mathrm{NE}}\) 高 \(\rightarrow\) \(P_t \downarrow\)（更保守、更确定）
- \(N_{\mathrm{NE}}\) 低 \(\rightarrow\) \(P_t \uparrow\)（更发散、更随机）
- \(N_{\mathrm{5HT}}\) 的作用方向由设计决定（应保持单调、可限幅、可回滚）

#### 5.3.2 限幅保护

Top-P 限幅：

$$
top\_p \in [p_{min}, p_{max}]
$$

### 5.4 最大 Token 数映射

#### 5.4.1 映射公式

最大 Token 数映射：

$$
M_t = \mathrm{clamp}\bigl(M_{\min}, M_{\max},\ \alpha_M\cdot f_{\mathrm{energy}}(H_{\mathrm{energy}})\cdot f_{\mathrm{verbosity}}(b_4)\bigr)
$$

其中：
- \(M_t\)：max_tokens
- \(M_{\min},M_{\max}\)：长度预算边界（不展示真实数值）
- \(\alpha_M\)：基线项（符号化；不展示真实数值）

#### 5.4.2 能量因子

能量因子：

$$
f_{\mathrm{energy}}(H_{\mathrm{energy}}) = \beta_{e,0} + \beta_{e,1}\cdot H_{\mathrm{energy}}
$$

其中：
- \(\beta_{e,0}\)：能量因子基线（不展示真实数值）
- \(\beta_{e,1}\)：能量因子尺度（不展示真实数值）

**参数解释**：
- \(\beta_{e,0}\)：控制基础能量因子
- \(\beta_{e,1}\)：控制能量对长度预算的影响程度

#### 5.4.3 话量因子

话量因子：

$$
f_{\mathrm{verbosity}}(b_4) = \beta_{v,0} + \beta_{v,1}\cdot b_4
$$

其中：
- \(\beta_{v,0}\)：话量因子基线（不展示真实数值）
- \(\beta_{v,1}\)：话量因子尺度（不展示真实数值）

**参数解释**：
- \(\beta_{v,0}\)：控制基础话量因子
- \(\beta_{v,1}\)：控制话量对长度预算的影响程度

#### 5.4.4 限幅保护

最大 Token 数限幅：

$$
M_t \in [M_{\min}, M_{\max}]
$$

---

**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./04.md)** | **[下一节](./06.md)**
