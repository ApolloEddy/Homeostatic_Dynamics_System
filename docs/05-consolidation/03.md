**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./02.md)** | **[下一节](./04.md)**

# 05.3 记忆分箱（Binned Memory）
### 3.1 设计原理

把"记忆"拆成四类，避免混写导致漂移。每类记忆有不同的存储策略和检索策略。

### 3.2 记忆分类

| 类别 | 名称 | 描述 | 存储策略 | 检索策略 |
| :--- | :--- | :--- | :--- | :--- |
| **FactMemory** | 事实记忆 | 客观事实（可验证、低情绪） | 永久存储 | 向量相似度 |
| **RelationMemory** | 关系记忆 | 偏好、边界、承诺、禁忌 | 长期存储 | 时间衰减 + 状态偏置 |
| **AffectMemory** | 情绪记忆 | 触发器、情绪图谱、当时状态 | 中期存储 | 时间衰减 + 状态偏置 |
| **StyleMemory** | 风格记忆 | 在某类状态下的表达模板/语气策略 | 短期存储 | 状态匹配 |

### 3.3 记忆条目结构

#### 3.3.1 记忆条目格式

记忆条目格式示例（使用伪变量）：

```json
{
  "id": "uuid",
  "category": "relation",
  "content": "用户不喜欢被问及个人隐私",
  "importance": "<IMPORTANCE>",
  "timestamp": "<ISO8601_TIMESTAMP>",
  "stateSnapshot": {
    "hSocial": "<H_social>",
    "hEnergy": "<H_energy>",
    "da": "<N_DA>",
    "ne": "<N_NE>",
    "ht": "<N_5HT>"
  },
  "rpe": "<RPE>",
  "embedding": "<EMBEDDING_VECTOR>"
}
```

> [!NOTE]
> 字段含义与符号约束见：`docs/appendix/parameter-symbols.md`。

### 3.4 字段说明

| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | String | 记忆唯一标识 |
| `category` | String | 记忆类别 |
| `content` | String | 记忆内容 |
| `importance` | Number | 记忆重要性（有界：$[I_{\min}, I_{\max}]$） |
| `timestamp` | String | 记忆时间戳 |
| `stateSnapshot` | Object | 当时状态快照 |
| `rpe` | Number | 奖赏预测误差 |
| `embedding` | Array | 向量嵌入（可选） |

---

**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./02.md)** | **[下一节](./04.md)**
