**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./03.md)** | **[下一节](./05.md)**

# 05.4 动态 Few-shot 注入
### 4.1 设计原理

当处于特定状态（例如低 DA/高 NE）时，仅检索 **StyleMemory** 的历史片段作为 few-shot，避免注入过多上下文导致注意力污染。

### 4.2 注入策略

#### 4.2.1 注入条件

注入条件：

$$
\text{if } (N_{\mathrm{DA}} < \tau_{\mathrm{da,low}} \ \text{or}\ N_{\mathrm{NE}} > \tau_{\mathrm{ne,high}})\ \text{ then inject}
$$

其中：
- $\tau_{\mathrm{da,low}}$：DA 低阈值（符号化）
- $\tau_{\mathrm{ne,high}}$：NE 高阈值（符号化）

**参数解释**：
- $\tau_{\mathrm{da,low}}$：控制何时注入 few-shot
- $\tau_{\mathrm{ne,high}}$：控制何时注入 few-shot

#### 4.2.2 注入数量

注入数量：

$$
n_{fewshot} = \min(n_{max}, n_{available})
$$

其中：
- $n_{max}$：最大注入数量（不展示真实数值）
- $n_{available}$：可用记忆数量

**参数解释**：
- $n_{max}$：最大注入数量，控制 few-shot 的数量

#### 4.2.3 注入预算

注入预算：

$$
M_{\mathrm{few}} \le M_{\mathrm{few,max}}
$$

其中：
- \(M_{\mathrm{few}}\)：few-shot 注入 token 数量（计数）
- \(M_{\mathrm{few,max}}\)：few-shot 注入 token 预算上限（不展示真实数值）

**参数解释**：
- \(M_{\mathrm{few,max}}\)：控制 few-shot 的 token 成本与注意力挤占风险

### 4.3 注入格式

#### 4.3.1 原文注入格式

原文注入格式：

```
[STYLE_EXAMPLES]
示例 1：
用户：...
系统：...

示例 2：
用户：...
系统：...
[/STYLE_EXAMPLES]
```

#### 4.3.2 摘要注入格式

摘要注入格式（超预算时使用）：

```
[STYLE_SUMMARY]
在低 DA/高 NE 状态下，系统倾向于：
- 简洁回应
- 聚焦主题
- 避免长解释
[/STYLE_SUMMARY]
```

---

**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./03.md)** | **[下一节](./05.md)**
