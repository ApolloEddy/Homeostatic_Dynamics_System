**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./01.md)** | **[下一节](./03.md)**

# 05.2 日志结构（State-Aware Logging）
### 2.1 设计原理

每轮交互记录"说了什么 + 当时状态 + 事件标签"，为后续巩固提供完整上下文。

### 2.2 日志结构

#### 2.2.1 交互日志格式

交互日志格式示例（使用伪变量）：

```json
{
  "ts": "<ISO8601_TIMESTAMP>",
  "user": "用户输入内容",
  "assistant": "系统响应内容",
  "state": {
    "hSocial": "<H_social>",
    "hEnergy": "<H_energy>",
    "da": "<N_DA>",
    "ne": "<N_NE>",
    "ht": "<N_5HT>"
  },
  "behavior": {
    "initiative": "<b_initiative>",
    "warmth": "<b_warmth>",
    "patience": "<b_patience>",
    "verbosity": "<b_verbosity>",
    "directness": "<b_directness>",
    "defensiveness": "<b_defensiveness>",
    "curiosity": "<b_curiosity>",
    "boundaryStrength": "<b_boundary>"
  },
  "events": ["criticism", "threat_like", "high_surprise"],
  "rpe": {
    "reward": "<RPE_reward>",
    "threat": "<RPE_threat>"
  },
  "toolUsage": {
    "retrieval": true,
    "tools": ["tool1", "tool2"],
    "tokenOut": "<TOKEN_OUT>"
  }
}
```

> [!NOTE]
> 占位符符号与约束见：`docs/appendix/parameter-symbols.md`；代码块展示规范见：`docs/STYLE.md`。

### 2.3 字段说明

| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| `ts` | String | 时间戳（ISO 8601 格式） |
| `user` | String | 用户输入内容 |
| `assistant` | String | 系统响应内容 |
| `state` | Object | 当时状态快照 |
| `behavior` | Object | 当时行为向量 |
| `events` | Array | 事件标签 |
| `rpe` | Object | 奖赏预测误差 |
| `rpe.reward` | Number | 奖赏 RPE |
| `rpe.threat` | Number | 威胁 RPE |
| `toolUsage` | Object | 工具使用情况 |
| `toolUsage.retrieval` | Boolean | 是否使用检索 |
| `toolUsage.tools` | Array | 使用的工具列表 |
| `toolUsage.tokenOut` | Number | 输出 token 数 |

---

**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./01.md)** | **[下一节](./03.md)**
