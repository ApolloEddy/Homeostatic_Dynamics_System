**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./05.md)** | **[下一节](./07.md)**

# 05.6 记忆摄入（Memory Ingestion）
### 6.1 设计原理

记忆摄入负责将交互日志转换为记忆条目，并存储到分箱记忆系统中。

### 6.2 摄入流程

#### 6.2.1 记忆分类

记忆分类：

```dart
enum MemoryCategory {
  fact,
  relation,
  affect,
  style,
}
```

#### 6.2.2 重要性评估

重要性评估：

$$
importance = w_{rpe} \cdot |RPE| + w_{state} \cdot \text{state\_match} + w_{recency} \cdot \text{recency}
$$

其中：
- $w_{rpe}$：RPE 权重（不展示真实数值）
- $w_{state}$：状态匹配权重（不展示真实数值）
- $w_{recency}$：近期性权重（不展示真实数值）
- $\text{state\_match}$：状态匹配度（归一化到有界区间：$[S_{\min}, S_{\max}]$）
- $\text{recency}$：近期性（归一化到有界区间：$[S_{\min}, S_{\max}]$）

**参数解释**：
- $w_{rpe}$：RPE 权重，控制 RPE 对重要性的影响
- $w_{state}$：状态匹配权重，控制状态匹配对重要性的影响
- $w_{recency}$：近期性权重，控制近期性对重要性的影响

### 6.3 记忆存储

#### 6.3.1 存储策略

存储策略：

- **FactMemory**：永久存储，不删除
- **RelationMemory**：长期存储，低重要性删除
- **AffectMemory**：中期存储，低重要性删除
- **StyleMemory**：短期存储，定期清理

#### 6.3.2 存储容量

存储容量：

$$
N_{category} \le N_{category,max}
$$

其中：
- $N_{category}$：类别记忆数量
- $N_{category,max}$：类别最大记忆数量

**参数解释**：
- $N_{fact,max}$：事实记忆最大数量（不展示真实数值）
- $N_{relation,max}$：关系记忆最大数量（不展示真实数值）
- $N_{affect,max}$：情绪记忆最大数量（不展示真实数值）
- $N_{style,max}$：风格记忆最大数量（不展示真实数值）

---

**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./05.md)** | **[下一节](./07.md)**
