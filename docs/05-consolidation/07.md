**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./06.md)** | **[下一节](./08.md)**

# 05.7 记忆检索（Memory Retrieval）
### 7.1 设计原理

记忆检索负责从分箱记忆系统中检索相关记忆，并根据当前状态进行偏置。

### 7.2 检索流程

#### 7.2.1 向量检索

向量检索（FactMemory）：

$$
score_{vector} = \cos(\mathbf{q}, \mathbf{m}) \cdot w_{fact}
$$

其中：
- $\mathbf{q}$：查询向量
- $\mathbf{m}$：记忆向量
- $w_{fact}$：事实记忆权重（不展示真实数值）

**参数解释**：
- $w_{fact}$：事实记忆权重，控制事实记忆的检索权重

#### 7.2.2 时间衰减检索

时间衰减检索（RelationMemory、AffectMemory）：

$$
score_{time} = \text{importance} \cdot e^{-age/h_{half\_life}} \cdot w_{category}
$$

其中：
- $age$：记忆年龄
- $h_{half\_life}$：半衰期
- $w_{category}$：类别权重

**参数解释**：
- $h_{half\_life}$：半衰期，控制记忆衰减速度
- $w_{relation}$：关系记忆权重（不展示真实数值）
- $w_{affect}$：情绪记忆权重（不展示真实数值）

#### 7.2.3 状态匹配检索

状态匹配检索（StyleMemory）：

$$
score_{state} = \text{state\_match} \cdot w_{style}
$$

其中：
- $\text{state\_match}$：状态匹配度
- $w_{style}$：风格记忆权重（不展示真实数值）

**参数解释**：
- $w_{style}$：风格记忆权重，控制风格记忆的检索权重

### 7.3 检索偏置

#### 7.3.1 状态偏置

状态偏置：

$$
score_{biased} = score \cdot (1 + w_{state\_bias} \cdot \text{state\_match})
$$

其中：
- $w_{state\_bias}$：状态偏置权重（不展示真实数值）

**参数解释**：
- $w_{state\_bias}$：状态偏置权重，控制状态对检索的影响

---

**[返回目录](../INDEX.md)** | **[返回本章](./README.md)** | **[上一节](./06.md)** | **[下一节](./08.md)**
